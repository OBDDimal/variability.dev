<!--EXECUTE: npx serve in transpiler folder to see visualisation -->
<!--THIS FILE IS FOR TESTING PURPOSE ONLY AND CAN BE DELETED -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.3.11/dist/g6.min.js"></script>
    <title>Test</title>
</head>

<body>
    <div style="width: 100vw; height: 100vh" id="mountNode"></div>
    <script defer>
        fetch("xmlExamples/g6_model.json")
            .then((res) => res.json())
            .then((data) => {
                const container = document.getElementById("mountNode");
                const width = container.scrollWidth;
                const height = container.scrollHeight || 500;
                const treeDir = "TB"; // H / V / LR / RL / TB / BT
                const strokeColor = '#a2a2a2';
                const concreteNodeColor = '#ccccff';
                const abstractNodeColor = '#f2f2ff';
                const graph = new G6.TreeGraph({
                    container: "mountNode",
                    width,
                    height,
                    linkCenter: true,
                    modes: {
                        default: [
                            {
                                type: "collapse-expand-combo",
                                trigger: "click",
                                /*
                                onChange(item, collapsed) {
                                    data.collapsed = collapsed;
                                    return true;
                                },
                                */
                                relayout: true,
                            },
                            {
                                type: 'zoom-canvas',
                                enableOptimize: true,
                                //optimizeZoom: 0.9,
                            },
                            {
                                type: 'drag-canvas',
                                enableOptimize: true,
                            },
                            /*
                            {
                                type: 'scroll-canvas',
                                enableOptimize: true,
                            },
                            */
                        ],
                    },
                    defaultNode: {
                        type: 'rect',
                        size: [20, 20], //default node size, will be overwritten later
                        anchorPoints: [
                            [0, 0.5],
                            [1, 0.5],
                        ],
                        style: {
                            fill: concreteNodeColor,
                            stroke: strokeColor,
                        },
                    },
                    defaultEdge: {
                        type: "cubic-vertical",
                    },
                    layout: {
                        type: "dendrogram", // is TreeGraph
                        direction: treeDir,
                        gpuEnabled: true,
                        preventOverlap: true,
                        nodeSep: 40,
                        rankSep: 100,
                    },
                });

                graph.node(function (node) {
                    let fontSizeDuplicator = 7 //choosen via try and error
                    //label's position, options: center, top, bottom, left, right
                    let position = "center";
                    let rotate = 0;
                    //resize node according to label length
                    let newPos = (node.id.length + 2) * fontSizeDuplicator;
                    let size = [newPos, node.size[1]]
                    if (treeDir == "TB" && !node.children.length) {
                        //position = "bottom"; //pos for label of node
                        rotate = Math.PI / 2;
                        //interchange width and height
                        size = [size[1], size[0]];
                    } 

                    return {
                        label: node.id,
                        size: size,
                        style: {
                            fill: (node.fm_attributes.abstract ? abstractNodeColor : concreteNodeColor),
                            stroke: strokeColor,
                        },
                        labelCfg: {
                            position,
                            offset: 1,
                            style: {
                                rotate,
                                fontFamily: 'courier'
                            },
                        },
                    };
                });

                graph.data(data);
                graph.render();
                graph.fitCenter();

                if (typeof window !== "undefined")
                    window.onresize = () => {
                        if (!graph || graph.get("destroyed")) return;
                        if (
                            !container ||
                            !container.scrollWidth ||
                            !container.scrollHeight
                        )
                            return;
                        graph.changeSize(container.scrollWidth, container.scrollHeight);
                    };
            });
    </script>
</body>

</html>